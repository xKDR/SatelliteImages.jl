<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic concepts · NighttimeLights.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://github.com/JuliaPlanet/NighttimeLights.jl/concepts.html"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">NighttimeLights.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li class="is-active"><a class="tocitem" href="concepts.html">Basic concepts</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Loading-and-saving-files"><span>Loading and saving files</span></a></li><li class="toplevel"><a class="tocitem" href="#Mapping-between-earth-and-arrays"><span>Mapping between earth and arrays</span></a></li><li class="toplevel"><a class="tocitem" href="#Masks"><span>Masks</span></a></li></ul></li><li><a class="tocitem" href="polygons.html">Polygons and shapefiles</a></li><li><a class="tocitem" href="data_cleaning.html">Data Cleaning</a></li><li><a class="tocitem" href="tutorial.html">Tutorial</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="concepts.html">Basic concepts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="concepts.html">Basic concepts</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/master/docs/src/concepts.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basics-of-nighttime-lights-data"><a class="docs-heading-anchor" href="#Basics-of-nighttime-lights-data">Basics of nighttime lights data</a><a id="Basics-of-nighttime-lights-data-1"></a><a class="docs-heading-anchor-permalink" href="#Basics-of-nighttime-lights-data" title="Permalink"></a></h1><p>NOAA provides tif files of the nightlights images. Images in the package are represented as 2D arrays with floating-point values. Images of different months are stacked together to form 3D arrays. In this package, such 3D arrays are called datacubes. The following examples demonstrate how array indices work in Julia in the context of this package. </p><pre><code class="language-julia">image[1, 2]</code></pre><p>Returns the value of the image at location [1, 2]. 1st row and 2nd column. </p><pre><code class="language-julia">datacube[:, :, 3]</code></pre><p>Returns the image of the 3rd month.</p><pre><code class="language-julia">datacube[1, 2, :]</code></pre><p>Returns the time series values of the pixel at location [1, 2]. </p><pre><code class="language-julia">datacube[1, 2, 3]</code></pre><p>Returns the value of the image at location [1, 2] of the 3rd month. </p><h1 id="Loading-and-saving-files"><a class="docs-heading-anchor" href="#Loading-and-saving-files">Loading and saving files</a><a id="Loading-and-saving-files-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-and-saving-files" title="Permalink"></a></h1><p>Images and datacubes can be be loaded and saved using the following functions. </p><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.load_img-Tuple{Any}" href="#NighttimeLights.load_img-Tuple{Any}"><code>NighttimeLights.load_img</code></a> — <span class="docstring-category">Method</span></header><section><div><p>NOAA provides nighttime lights images as tif files. They can be opened as 2D arrays using the load_img function. </p><pre><code class="language-julia">load_img(&quot;example.tif&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/data_io.jl#L1-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.save_img-Tuple{Any,Any}" href="#NighttimeLights.save_img-Tuple{Any,Any}"><code>NighttimeLights.save_img</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Images in the form of 2D arrays can be saved as tif files. </p><pre><code class="language-julia">save_img(&quot;example.tif&quot;, img)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/data_io.jl#L13-L18">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.load_datacube-Tuple{Any}" href="#NighttimeLights.load_datacube-Tuple{Any}"><code>NighttimeLights.load_datacube</code></a> — <span class="docstring-category">Method</span></header><section><div><p>NOAA provides images for each month since April 2012. Images of the same place taken at different times can be stacked together to make a 3D array representating a panel data. In this package, we refer to such arrays as datacubes. JLD files containing 3D arrays can be loaded using the load_datacube function.  </p><pre><code class="language-julia">load_datacube(&quot;example.jld&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/data_io.jl#L23-L28">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.make_datacube-Tuple{Any}" href="#NighttimeLights.make_datacube-Tuple{Any}"><code>NighttimeLights.make_datacube</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Loads all images (tif files) in a folder and generates a datacube. The function prints the file names to you the order in which they are loaded. </p><pre><code class="language-julia">make_datacube(&quot;~/Downloads/ntl_images&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/data_io.jl#L44-L49">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.save_datacube-Tuple{Any,Any}" href="#NighttimeLights.save_datacube-Tuple{Any,Any}"><code>NighttimeLights.save_datacube</code></a> — <span class="docstring-category">Method</span></header><section><div><p>3D arrays can be saved as JLD files. </p><pre><code class="language-julia">save_datacube(&quot;example.jld&quot;, datacube)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/data_io.jl#L34-L39">source</a></section></article><h1 id="Mapping-between-earth-and-arrays"><a class="docs-heading-anchor" href="#Mapping-between-earth-and-arrays">Mapping between earth and arrays</a><a id="Mapping-between-earth-and-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Mapping-between-earth-and-arrays" title="Permalink"></a></h1><p>Suppose you want to find which location has the maximum value of light in an image. You can use the findmax function in julia.</p><pre><code class="language-julia">findmax(my_image)</code></pre><p>Suppose, the answer is [2000, 3000]. If you want to find the coordinates of this location, you&#39;ll need a mapping between the earth&#39;s coordinates and the image&#39;s indices. </p><p>Similarly, if you were given a pair of latitude and longitude, for example, (19.05, 73.01), and you need to find the radiance of that coordinate (approximately), you&#39;ll need to convert these number to your image&#39;s indices. </p><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.CoordinateSystem" href="#NighttimeLights.CoordinateSystem"><code>NighttimeLights.CoordinateSystem</code></a> — <span class="docstring-category">Type</span></header><section><div><p>The mapping between the coordinates of earth and indices of the image is needed to convert from one to another. In this package such mapping is referred to as a coordinate system. To define a coordinate system, you need to provide coordinates of the top-left and bottom-right pixels, and the height and the width of the image. </p><p>Suppose the image we plan to load had 8000 rows and 7100 columns. The top-left coordinate (37.5, 67.91666) is and bottom-right (4.166, 97.5). We can use these to create a the mapping. </p><pre><code class="language-julia">top_left     = Coordinate(37.5, 67.91666)
bottom_right = Coordinate(4.166, 97.5)
height = 8000
width  = 7100
my_coordinate_system = CoordinateSystem(top_left, bottom_right, height, width)</code></pre><p>Now functions can use this mapping to go from one to another. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L13-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.lat_to_row-Tuple{CoordinateSystem,Any}" href="#NighttimeLights.lat_to_row-Tuple{CoordinateSystem,Any}"><code>NighttimeLights.lat_to_row</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To convert from latitude to row number of an image, use the <code>lat_to_row</code> function. </p><p><strong>Example:</strong></p><pre><code class="language-julia">lat_to_row(my_coordinate_system, 19.6) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L34-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.long_to_column-Tuple{CoordinateSystem,Any}" href="#NighttimeLights.long_to_column-Tuple{CoordinateSystem,Any}"><code>NighttimeLights.long_to_column</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To convert from longitude to column number of an image use the <code>long_to_column</code> function. </p><p><strong>Example:</strong></p><pre><code class="language-julia">long_to_column(my_coordinate_system, 73.33) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L47-L53">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.row_to_lat-Tuple{CoordinateSystem,Any}" href="#NighttimeLights.row_to_lat-Tuple{CoordinateSystem,Any}"><code>NighttimeLights.row_to_lat</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To convert from row number of an image to latitude use the <code>row_to_lat</code> function. </p><p><strong>Example:</strong></p><pre><code class="language-julia">row_to_lat(my_coordinate_system, 100) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L60-L66">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.column_to_long-Tuple{CoordinateSystem,Any}" href="#NighttimeLights.column_to_long-Tuple{CoordinateSystem,Any}"><code>NighttimeLights.column_to_long</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To convert from column number of an image to longitude use the <code>column_to_long</code> function.</p><p><strong>Example:</strong></p><pre><code class="language-julia">column_to_long(my_coordinate_system, 100) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L73-L79">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.coordinate_to_image-Tuple{CoordinateSystem,Coordinate}" href="#NighttimeLights.coordinate_to_image-Tuple{CoordinateSystem,Coordinate}"><code>NighttimeLights.coordinate_to_image</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To convert a coordinate from earth&#39;s coordinate system to image&#39;s row number and column number, use the <code>coordinate_to_image</code> function. </p><p><strong>Example:</strong></p><pre><code class="language-julia">coordinate_to_image(my_coordinate_system, Coordinate(19.49907, 72.721252)) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L87-L93">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.image_to_coordinate-Tuple{CoordinateSystem,Any}" href="#NighttimeLights.image_to_coordinate-Tuple{CoordinateSystem,Any}"><code>NighttimeLights.image_to_coordinate</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To convert a coordinate from image&#39;s row number and column number to earth&#39;s coordinate system use the <code>image_to_coordinate</code> function. </p><p><strong>Example:</strong></p><pre><code class="language-julia">image_to_coordinate(my_coordinate_system, [4320, 1153]) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/coordinate_system.jl#L97-L103">source</a></section></article><h1 id="Masks"><a class="docs-heading-anchor" href="#Masks">Masks</a><a id="Masks-1"></a><a class="docs-heading-anchor-permalink" href="#Masks" title="Permalink"></a></h1><p>Masks are 2D arrays consisting of 0s and 1s. The 1s determine the region of interest. The pixels with the value of 1 are referred to as lit and the ones with the value of 0 are referred to as dark. Masks are useful because they can be easily combined with one another.  </p><p>To demonstrate the concept of mask, here are 3 examples:</p><ol><li>If the region of interest is India, the points inside the boundary of India will be 1, while the remaining will be 0.  </li><li>If all pixels in an image below a threshold are considered background noise, such pixels can be marked as zero and the remaining can be marked as 1 to produce a background noise mask. For following code demonstrates this example. </li></ol><pre><code class="language-julia">image = rand(0:10.0, 10, 10)
noise_threshold = function(x, threshold)
    if x &lt; threshold
        return 0
    else 
        return 1
    end
end
threshold = 0.3
mask_mask = noise_threshold.(x, threshold) </code></pre><ol><li>The standard deviation of each pixel in a datacube can be computed. Suppose those pixels with standard deviation greater than a threshold are considered outliers. In a 2D array, these pixels can be marked as 0 and the remaining can be marked as 1 to generate an outlier mask. </li></ol><pre><code class="language-julia">datacube = rand(0:10.0, 10, 10, 10)
mask = zeros(10, 10)
std_threshold = 1
for i in 1:10
    for j in 1:10
        if std(datacube[i, j, :]) &gt; std_threshold
            mask[i, j] = 1
        end
    end
end</code></pre><p>If you multiply (elementwise) the 3 masks, you get a mask that represents the pixels above the threshold, which are inside India and which are not outliers. </p><p>To find the number of pixels in a mask, one simply needs to do: </p><pre><code class="language-julia">sum(mask)</code></pre><p>To find the area of the mask, the mask_area function of the package can be used. </p><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.mask_area-Tuple{CoordinateSystem,Any}" href="#NighttimeLights.mask_area-Tuple{CoordinateSystem,Any}"><code>NighttimeLights.mask_area</code></a> — <span class="docstring-category">Method</span></header><section><div><p>The area of each pixel is added to determine the total area of a mask. </p><pre><code class="nohighlight">mask = rand(0:1,8000,7100) 
mask_area(INDIA_COORDINATE_SYSTEM, mask) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/area.jl#L13-L19">source</a></section></article><p>An image can be multiplied with a mask (elementwise) so that only the pixels lit in the mask are lit in the images. For example: </p><pre><code class="language-julia">image .* noise_mask</code></pre><p>Returns as image with 0s wherever there is background noise and the remaining values are the same as the original image. </p><h3 id="Aggregating-over-masks"><a class="docs-heading-anchor" href="#Aggregating-over-masks">Aggregating over masks</a><a id="Aggregating-over-masks-1"></a><a class="docs-heading-anchor-permalink" href="#Aggregating-over-masks" title="Permalink"></a></h3><p>While using nighttime lights, you may need to find the total lit of an image over a mask.  </p><p>For example, if you have a background noise mask (where pixels considered noise are marked as 0 and the remaining at marked as 1), you may need to find the the total of an image over the lit pixels of the mask. </p><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.aggregate-Tuple{Any,Any}" href="#NighttimeLights.aggregate-Tuple{Any,Any}"><code>NighttimeLights.aggregate</code></a> — <span class="docstring-category">Method</span></header><section><div><p>The aggregate value of an image over a mask can be computed by the aggregate function. The function multiplies the image and the mask (elementwise) and then performs the summation. </p><pre><code class="nohighlight">rand_image = rand(10, 10)
rand_mask = rand(0:1, 10, 10)
aggregate(rand_image, rand_mask)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/aggregate.jl#L1-L8">source</a></section></article><p>The aggregate function is equivalent to </p><pre><code class="language-julia">sum(image .* mask)</code></pre><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.aggregate_timeseries-Tuple{Any,Any}" href="#NighttimeLights.aggregate_timeseries-Tuple{Any,Any}"><code>NighttimeLights.aggregate_timeseries</code></a> — <span class="docstring-category">Method</span></header><section><div><p>To find the time series of aggregate values of a datacube over a mask, using the <code>aggregate_timeseries</code> function</p><pre><code class="nohighlight">rand_datacube = rand(10, 10, 10)
rand_mask = rand(0:1, 10, 10)
aggregate_timeseries(rand_datacube, rand_mask)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaPlanet/NighttimeLights.jl/blob/023d88ec93c0cd6dc327208bb698ef4eb5287e86/src/aggregate.jl#L14-L22">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Home</a><a class="docs-footer-nextpage" href="polygons.html">Polygons and shapefiles »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 8 November 2021 18:42">Monday 8 November 2021</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
